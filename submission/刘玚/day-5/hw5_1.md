# ç­”é¢˜å¡

## 1 å¹¶è¡Œç­–ç•¥ä¸å¼ é‡ shape

### 1.1

#### 1.1.1
æ¯ä¸ª rank ä¸Šçš„æƒé‡çŸ©é˜µ $$W_1^{(i)}$$ shape æ˜¯ $$1024 \times 256$$

#### 1.1.2
æ¯ä¸ª rank è¾“å…¥çš„å¼ é‡ $$X$$ çš„ shape æ˜¯ $$8 \times 128 \times 1024$$

#### 1.1.3
æ¯ä¸ª rank æœ¬åœ°è¾“å‡º $$Y_i$$ çš„ shape æ˜¯ $$8 \times 128 \times 256$$

æœ€ç»ˆé€šè¿‡ AllReduce æ“ä½œå¾—åˆ°å®Œæ•´çš„ $$Y$$ï¼š$$Y = \text{AllReduce}(Y_1, Y_2, Y_3, Y_4)$$


### 1.2

#### 1.2.1
æ¯ä¸ª rank ä¸Šçš„æƒé‡çŸ©é˜µ $$W_2^{(i)}$$ shape æ˜¯ $$1024 \times 1024$$


#### 1.2.2
æ¯ä¸ª rank æ¥å—è¾“å…¥çš„å¼ é‡ çš„ shape æ˜¯ $$8 \times 128 \times 256$$

#### 1.2.3
æ¯ä¸ª rank æœ¬åœ°è¾“å‡º $$Z_i$$ çš„ shape æ˜¯ $$8 \times 128 \times 1024$$

æœ€ç»ˆé€šè¿‡ AllGather æ“ä½œå¾—åˆ°å®Œæ•´çš„ $$Z$$ï¼š$$Z = \text{AllGather}(Z_1, Z_2, Z_3, Z_4)$$


## 2 é€šä¿¡åˆ†æ

### 2.1

#### 2.1.1
å‰å‘ä¼ æ’­éœ€è¦é€šä¿¡ã€‚é€šä¿¡æ“ä½œæ˜¯ AllReduceï¼Œé€šä¿¡é‡æ˜¯ $$8 \times 128 \times 4096 \times 4 = 16,777,216$$ ä¸ªå…ƒç´ ã€‚

#### 2.1.2
åå‘ä¼ æ’­æ—¶ï¼Œè®¡ç®— $$\partial L / \partial X$$ ä¸éœ€è¦é€šä¿¡ã€‚


### 2.2

#### 2.2.1
å‰å‘ä¼ æ’­éœ€è¦é€šä¿¡ã€‚é€šä¿¡æ“ä½œæ˜¯ AllGatherï¼Œé€šä¿¡é‡æ˜¯ $$8 \times 128 \times 1024 \times 4 = 4,194,304$$ ä¸ªå…ƒç´ ã€‚

#### 2.2.2
åå‘ä¼ æ’­æ—¶ï¼Œè®¡ç®— $$\partial L / \partial X$$ éœ€è¦é€šä¿¡ã€‚


# 3 å¦‚æœä¸¤å±‚éƒ½ä½¿ç”¨ Row Parallelï¼Œä¼šäº§ç”Ÿå“ªäº›é¢å¤–é€šä¿¡ï¼Ÿä¸¤å±‚éƒ½ä½¿ç”¨ Column Parallel ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿ

**ä¸¤å±‚éƒ½ä½¿ç”¨ Row Parallel çš„é¢å¤–é€šä¿¡ï¼š**

1. **Linear1 è¾“å‡ºåˆ° Linear2 è¾“å…¥ä¹‹é—´çš„é€šä¿¡ï¼š** éœ€è¦å°† Linear1 çš„è¾“å‡º $$Y$$ æŒ‰è¡Œé‡æ–°åˆ†å‰²ç»™ Linear2 çš„å„ä¸ª rankï¼Œè¿™éœ€è¦é¢å¤–çš„ AllGather + Scatter æ“ä½œã€‚

2. **é€šä¿¡å¼€é”€å¢åŠ ï¼š** ç›¸æ¯” Column + Row çš„ç»„åˆï¼ŒRow + Row éœ€è¦æ›´å¤šçš„é€šä¿¡æ­¥éª¤ã€‚

**ä¸¤å±‚éƒ½ä½¿ç”¨ Column Parallel çš„é—®é¢˜ï¼š**

1. **æƒé‡çŸ©é˜µç»´åº¦ä¸åŒ¹é…ï¼š** Linear1 è¾“å‡ºç»´åº¦æ˜¯ $$4d = 4096$$ï¼ŒLinear2 è¾“å…¥ç»´åº¦ä¹Ÿæ˜¯ $$4d = 4096$$ï¼Œå¦‚æœéƒ½ç”¨ Column Parallelï¼Œä¼šå¯¼è‡´ç»´åº¦ä¸åŒ¹é…ã€‚

2. **é€šä¿¡å¼€é”€å·¨å¤§ï¼š** ä¸¤å±‚éƒ½éœ€è¦ AllReduceï¼Œé€šä¿¡å¼€é”€ä¼šæ˜¾è‘—å¢åŠ ã€‚

3. **è´Ÿè½½ä¸å‡è¡¡ï¼š** æ‰€æœ‰è®¡ç®—éƒ½é›†ä¸­åœ¨ç›¸åŒçš„ç»´åº¦ä¸Šè¿›è¡Œåˆ†å‰²ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨å¹¶è¡Œåº¦ã€‚

**æœ€ä¼˜ç­–ç•¥ï¼š** Linear1 ä½¿ç”¨ Column Parallel + Linear2 ä½¿ç”¨ Row Parallel çš„ç»„åˆæ˜¯æœ€ä¼˜çš„ï¼Œå› ä¸ºï¼š
- ç»´åº¦åŒ¹é…ï¼šLinear1 è¾“å‡º $$4d$$ ç»´åº¦æ­£å¥½å¯¹åº” Linear2 è¾“å…¥ $$4d$$ ç»´åº¦
- é€šä¿¡å¼€é”€æœ€å°ï¼šåªéœ€è¦å¿…è¦çš„ AllReduce å’Œ AllGather
- è´Ÿè½½å‡è¡¡ï¼šä¸¤ä¸ªç»´åº¦éƒ½èƒ½å……åˆ†åˆ©ç”¨å¹¶è¡Œåº¦

## ğŸš€ **å®Œæ•´ä¼ è¾“å‘½ä»¤**

### **rsync å‘½ä»¤**ï¼ˆæ¨èï¼Œæœ€å¿«ï¼‰
```bash
rsync -avz --progress -e "ssh -i /Users/ios/.ssh/id_rsa -p 20000" /remote-home1/bwang/hw4/ yliu@10.176.52.125:"/remote-home1/yliu/SummerQuest-2025/submission/åˆ˜çš/"
```

### **scp å‘½ä»¤**ï¼ˆå¤‡é€‰ï¼‰
```bash
scp -i /Users/ios/.ssh/id_rsa -P 20000 -r /remote-home1/bwang/hw4 yliu@10.176.52.125:"/remote-home1/yliu/SummerQuest-2025/submission/åˆ˜çš/"
```

## ğŸ”§ **å‚æ•°è¯´æ˜**

- `-i /Users/ios/.ssh/id_rsa`ï¼šæŒ‡å®šç§é’¥æ–‡ä»¶
- `-p 20000`ï¼ˆrsyncï¼‰/ `-P 20000`ï¼ˆscpï¼‰ï¼šæŒ‡å®šç«¯å£å·
- `-r`ï¼šé€’å½’å¤åˆ¶ç›®å½•
- `-avz`ï¼šå½’æ¡£æ¨¡å¼ + è¯¦ç»†è¾“å‡º + å‹ç¼©
- `--progress`ï¼šæ˜¾ç¤ºä¼ è¾“è¿›åº¦

## âš ï¸ **æ³¨æ„äº‹é¡¹**

1. **ç›®æ ‡è·¯å¾„åŒ…å«ä¸­æ–‡**ï¼Œç”¨å¼•å·åŒ…å›´è·¯å¾„
2. **ç«¯å£å‚æ•°ä¸åŒ**ï¼š
   - rsync: `-p 20000`
   - scp: `-P 20000`ï¼ˆå¤§å†™Pï¼‰
3. **ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨**ï¼Œæˆ–è€…rsyncä¼šè‡ªåŠ¨åˆ›å»º

## ğŸ“ **æ¨èå‘½ä»¤**ï¼ˆç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼‰

```bash
rsync -avz --progress -e "ssh -i /Users/ios/.ssh/id_rsa -p 20000" /remote-home1/bwang/hw4/ yliu@10.176.52.125:"/remote-home1/yliu/SummerQuest-2025/submission/åˆ˜çš/"
```

è¿™ä¸ªå‘½ä»¤ä¼šæŠŠ `hw4` ç›®å½•é‡Œçš„æ‰€æœ‰å†…å®¹ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨çš„æŒ‡å®šè·¯å¾„ä¸­ã€‚